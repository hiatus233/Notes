[D:\游戏策划案\长期个人学习项目  初定终版.docx](file:///D:/%E6%B8%B8%E6%88%8F%E7%AD%96%E5%88%92%E6%A1%88/%E9%95%BF%E6%9C%9F%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE%20%20%E5%88%9D%E5%AE%9A%E7%BB%88%E7%89%88.docx)
# TODO 
- [1] 重构敌人ai 🔼
	- [x] 将敌人的意图重新写成枚举类型（就那么几种固定的），将敌人的攻击做成SO,把敌人的移动做成函数
     - [1] 对周围一部分格子进行攻击（遍历周围一圈的格子，如果玩家位于格子内，就进行攻击，如果不在，根据格子的属性对格子添加不同的effect（TODO））**CheckIfNoTarget函数**
    - [x] 对周围一圈格子进行范围攻击
    
	- [1] 进行移动后（这个移动的轨迹是固定的，可以被玩家看到）进行攻击——遍历移动范围内的所有格子并检验每个格子与玩家位置之间的距离，选择距玩家最近的为最终路径点（玩家在最远的移动范围+攻击范围外）,如果在移动后攻击范围内，则根据不同类型的敌人进行不同的操作——激进型、策略型、防御型
		- [ ] 显示敌人路径
		- [1] 敌人移动时避开lava或其他地块，但是玩家上一回合施加的地块效果无法被避开[[分析文档.canvas|分析文档]]
	- [1] 回血
    
	- [ ] 进行其他的操作
- [ ] 敌人采取的策略类型（策略类型目前只在移动后攻击上有区别）
	- [ ] 激进型——会一直跟着玩家
	- [ ] 防御型——根据玩家上一回合的位置进行攻击
	- [ ] 策略型——会尽量和玩家保持最大距离去攻击
- [ ] 完成敌人意图类型与攻击类型的简化，学习ITB式的意图显示方式 🔺 ➕ 2025-02-25
- [1] 在玩家回合时，鼠标悬停在敌人身上时 ⏫
	- [1] 显示敌人当前意图的作用范围
	- [1] 显示在敌人回合结束后敌人的当前位置和地图的变化
	- [1] 在拖拽卡牌时，摄像头虚化背景并聚焦在当前场景上，突出角色（？可能不用这个设置）
```
public class EnemyIntent : MonoBehaviour, IPointerEnterHandler, IPointerExitHandler
{
    public GameEvent ShowIntentRange;//展示意图范围
    public GameEvent HideIntentRange；//隐藏

    public void OnPointerEnter(PointerEventData eventData)
    {
        ShowIntentRange.Raise(); // 显示范围
    }

    public void OnPointerExit(PointerEventData eventData)
    {
        HideIntentRange.Raise(); // 隐藏范围
    }
}

```
- [1] 卡牌信息配置表（excel?so）
- [ ] 实现地形破坏功能
	- [x] 重构地形破坏的卡牌功能，用单独的系统[[#^dixing|^dixing]]去表现这一效果，以达到更好的扩展性。 ✅ 2025-02-25
	- [x] 破坏——摧毁一个地砖（实际是disable cell的render并检测对应Tile上是否有Entity，若有，则执行fallen方法——使entity坠落并受到伤害，若没有，则只disable cell的render）
	- [1] 敌人途径到被摧毁的地砖时（overlaytile.isActive = false）------寻路能得寻路到目前被摧毁的地砖上，且敌人得能够走到这个瓦片上——判定路径上是否有瓦片的isActive=false,如果有，则若该瓦片的activecharacter不为空，则执行fallen方法。
	- [x] fallen方法——目前考虑是多建一个obj，用来表现瓦片掉落（？）或者是摧毁的效果——播放timeline动画
	- [ ] 人物掉落动画
	- [ ] 
- [x] 击败当前层的敌人后，相机自动上移 ⏫
	- [x] 击败当前层的敌人后，玩家传送到上一层（传送到哪里？值得深思！）
	- [ ] 传送动画（动画什么的都往后稍稍）
- [x] 摄像机一次限定移动一层的距离，且卡牌布局的位置不能改变（相对canvas的位置），限定，Top和Bottom都有边界 📅 2024-10-31
- [1] 层状态分为当前层，上层，下层，上层的再上一层，下层的再下一层
	- [x] 默认只能看到当前，上，下三层，当玩家点击箭头按钮时能够观察到上层以及上上层的具体情况（下层同理） ✅ 2025-02-23
	- [ ] 上上层和下下层的敌人默认不加入回合中
	- [ ] 第一层的敌人应该先预先生成
	- [x] 当玩家传送到上层或下层时再将上上层或是下下层的人加入combinedList
- [x] 在新一层生成新的敌人（默认上中下三层先生成敌人） ⏫
	- [x] 简化逻辑，enemycontainer和enemyspawner中更新敌人数量的逻辑重合了
	- [x] 检测当前层和上层的敌人数是否为0，当前层如果为0，生成上上层敌人，上层敌人数为0，生成上上层敌人
	- [x] 更新enemycontainer的数据结构，能够存储每一层的敌人数量
	- [x] 在玩家当前层的敌人数为空后，上上上层的敌人需要在玩家传送后生成（不加入combineList）
	- [x] 开始时在第一层创建一个敌人，在第二层也创建1~2个敌人
	- [x] enenemyController中playercharacter列表中不为空，检测player的layer，如果在自己的当前层，则能够执行攻击等逻辑，不然只是一直在路径上徘徊
- [ ]  MapManager
	- [x] 在要生成敌人之前也要生成楼层Floor
	- [x] 在当前层敌人数量为空后，如果当前层的敌人在他自己的回合死亡，那么后续combinedlist中是别的敌人的回合触发tpWhenNoenemy，我想要只有玩家能够触发tpwhennoenemy
	- [1] 在地块上随机生成事件地块（商店，篝火等等）
	
- [x] 琢磨一下odin插件——会用就行
- [1] 优化UI系统，整合框架
	- [ ] 将玩家的血条放置到persistent中，能够持久化保存玩家状态，玩家血条放置到左上角，参考杀戮尖塔，能够更直观的表现自己的血量资源。
	- [ ] 美化一下UI，将玩家血条，遗物等信息整理一下
	- [x] 制作descriptionPanel,用于响应鼠标悬停事件
	- [x] 在游戏开始时，在玩家点击对应瓦片后生成player，并显示战斗UI() ✅ 2025-02-23
- [x] 设计金币 🔼——场景切换后保持金币不变（数据持久，将金币也添加到SO——statscontainer之中，仅玩家需要）
	- [x] 给玩家添加gold字段，封装到Stat类型，用于计算玩家所得金币数
- [1] 商店系统 ⏫ ➕ 2024-11-29 
	- [1] 利用CSVEditor读取商店的配置表文件
	- [ ] 在玩家购买商品后，解析shiopitemdataso的itemSOAddress，并从addressables group中实例化出对象加入到对应的存储容器中
	- [ ] 玩家拥有的遗物和药水用list存储，存档时在拆开存
	- [ ] 每次ShopPanel中会随机刷出不同的商品（遗物，卡牌，药水这几种类型的商品）
	- [ ] 拖动并购买商品，金币不够的话拖不太动商品（范围判断，如果金币不够商品就回弹到原来的位置）
	- [ ] 显示商品Panel后隐藏其他UI元素
	- [ ] 将商品购入后，更新玩家对应的存储容器中(如卡组或遗物区)的信息
		- [ ] 在回合中创建新卡(暂时性的衍生物)——更新卡组，换言之动态更新卡组。不改变NewGameLibrary(初始开始游戏时的卡牌库)和playerholdlibrary
	- [ ] 存储购买的商品（存档系统-json存储数据）——问题是存储什么数据？暂且先搁置，学起来又枯燥又难懂，小痛苦~~~
- [x] 先实现一下relic遗物机制吧 ⏫
- [ ] 存档系统
	- [ ] 对于存档系统来说，Scriptableobject转json并不支持复杂SO类（比如类内嵌套对象等），所以要考虑将对应的复杂SO类，转为对应的普通类进行[序列化](https://www.bilibili.com/opus/980703696992075785)。
	- [ ] 跨场景时玩家的statsContainer没有保存，需要保存玩家的状态。
	- [ ] 考虑慢慢地把项目从so存储改成json存储，以so存储的数据实在是有些过于臃肿了，好用但是不好维护
	- [ ] 保存数据类，重构entity，relic类，card类。
	- [ ] 将statscontainer修改成别的存储结构，而不是用so，这样游戏打包后玩家的状态并没有办法实时存储
- [1] 设计更多卡牌和遗物 🔽
- [x] 统一资源加载功能为addressables异步加载 并使用资源加载功能实现场景切换 ⏫ ➕ 2024-11-30 📅 2024-12-01

- [1] **随机事件(瓦片)**
	- [1] 在战斗开始时，每一层的随机瓦片上会出现标志(包括商店，篝火，随机事件)
		- [ ] 玩家能通过移动到这些随机标志位置上增强自身，同时摧毁这些地砖也会受到一些增益/减益
		- [ ] 随机的机制是？
- [x] **战斗结束后奖励** ✅ 2025-03-03
	- [x] 敌人死亡后掉落金币，金币能用来在商店购买遗物/卡牌 ✅ 2025-03-03
	- [x] 在一场战斗结束后，掉落卡牌 ✅ 2025-03-03
- **战斗结束的标志**
	- 扩充房间SO文件的字段，加入最大层数，在RoomManager中添加当前房间的so文件，在EnemySpawner或MapManager中添加对当前楼层的检测逻辑，若已经到达房间的最大层数上限，则不再生成更高层和更高层上的敌人。
	- 在检测到所有层的敌人均死亡后，触发事件HandleDrop(),跳出掉落奖励面板，点击对应奖励时相应对应事件。如：点击金币播放金币添加动画，点击卡牌跳转到选择卡牌界面，点击遗物跳转到选择遗物界面。
# 卡牌系统
- [ ] 给cardtype的defense类改为skill类，兼容移动类的卡牌
# 地图系统
- [ ] 开始第一关为普通敌人关卡，通过关卡后跳转到地图场景中，通过鼠标点击选择下一个房间
- [ ] 房间类型：普通、精英、首领、随机、商店、休息、宝箱
- [ ] 每次地图生成都会同步生成存档json文件，存档命名包含存档生成的时间戳
- [ ] 需要额外说明的是每次游戏流程中的所有随机内容都应该以种子内容保存，玩家输入同个种子后能够体验完全一致的随机内容和游戏流程
## 战斗房间
- [ ] 共用同一个场景，根据房间类型的不同生成不同数量和类型的敌人。
```ad-todo
战斗房间拥有[[原本persistent配置.png]]
其中与商店，卡组，遗物，玩家状态相关的都应该移到Persistent场景中。目前排查下来发现是：ShopManager，ShopController，CardManager，RelicManager，DropManager，RoomManager，OnShopDataLoaded_Listener

```
## 其余房间
- [ ] 自己有一个房间场景，选择该房间时跳转到对应场景。

![[file-20250304164009585.png]]

![[file-20250304164103803.png]]
## 参考图
![[file-20250303134548923.png]]
![[file-20250303134600785.png]]
- [ ] 添加更多地形效果
	- [ ] 固定地块上会出现NPC，鼠标点击与NPC对话
- [ ] 优化选牌逻辑体验，学习杀戮尖塔(用户鼠标左键点击卡牌时，卡牌被选中并产生箭头，此时按下右键取消选中卡牌)
- [ ] 破坏/建造地形系统 ⏫ ➕ 2025-02-12 🛫 2025-02-12 ✅ 2025-02-16 ^dixing
	- [x] 使用地形类型卡牌时将进入建造/破坏模式。 ✅ 2025-02-23
		- [x] 关闭其他所有UI，展示建造模式UI ✅ 2025-02-23
		- [x] 无论玩家建造/破坏与否，在使用破坏地形卡牌后这一行为无法被撤销(即进入建造/破坏模式之后这张卡就算已经使用) ✅ 2025-02-23
		- [ ] 破坏地形的牌的规则是，在第一层不能破坏对应的地砖，但是可以破坏掉对应的地形(effect)，所有地形牌基本都有**消耗**效果。
		- [ ] 
	- [ ] 建造/破坏模式下可以选择对应地砖
		- [x] 通过同样的mousecontroller选定对应瓦片 ✅ 2025-02-23
		- [ ] 通过currentPreview显示建造后效果
		- [ ] 在建造模式下鼠标右键取消建造效果，按下键盘上的esc退出建造模式
		- [ ] 鼠标左键点击建造瓦片后，弹出确认建造UI，再次点击确认退出建造模式
	- [2] 将地砖改为用对象池技术存储，便于复用。 ❌ 2025-03-13
 - [2] 或许重构最基础的Grid系统，改用TileMap，先初步迭代出原型 ➕ 2025-02-12 ❌ 2025-02-12——SBUnity-Tilemap根本满足不了我强烈的增删需求。 
 - [x] 降低耦合性，用事件减少一下报空的问题，比如MapGenerator中加载和创建数据时先用事件唤起 ✅ 2025-03-31
- [x] 随机地图 ✅ 2025-03-31
	- [x] 保存地图 ✅ 2025-03-31

- [ ] 🛫 2025-04-03 
```ad-hint
战斗房间的UI上
当玩家位于某层时，应该显示出玩家当前位于第几层，如图：
![[战斗UI.png]]
```


- [ ] 给敌人添加类型标记，不同类型的敌人有不同种的意图。
- [1] 添加地块随机事件系统。
	- [x] 添加解锁动画 ✅ 2025-04-24
	- [ ] 添加地块上的随机事件脚本
	- [ ] 重构Mapmanager中的存储结构，让所有cell共用一个预制体，而不是每一个cell都有不同的预制体，同个预制体只需要修改sprite即可
	- [ ] 随机地块的OBJ位于cell的子物体
	- [ ] 🛫 2025-04-26 现在的问题是在携带randomEvent的tile检索解锁条件的时候因为这个时候还没有玩家生成，所以会产生报空错误，我一开始的解决方案是将玩家用事件侦听的方式传递进去，但是在顺序上不可能，因为地形会先生成。
``` ad-note
	如果检索解锁条件的时机从生成时改为玩家生成并结束回合后，是不是就能修复这个BUG？
```

- [ ] 增加完整度，添加休息房，商店房和宝箱房还有随机房
	- [ ] 休息房
	- [ ] 商店房
	- [ ] 宝箱房
	- [ ] 随机房
- [ ] 添加更多敌人，给boss房还有精英房和普通敌人房做出区分
- [ ] 添加更多卡牌和遗物，增加内容丰富度
- [ ] 给buff添加显示UI，思考游戏最终的UI形态到底是什么
- [ ] 
- [ ] 🛫 2025-04-27  在回合结束敌人移动时，将摄像机主要放置到敌人身上，让玩家能够关注到每一个敌人的行动(因为不止一层)
# 美术资产

- [x] 主角四方向视图 
- [ ] 敌人素材
- [ ] 动画
	- [ ] 主角走路动画
- [ ] 卡牌背景
- [ ] 游戏背景
- [1] 游戏UI
	- [1] 开始界面
	- [ ] 死亡界面
	- [ ] 结束界面
	- [1] 游戏中界面
- [ ] 
- [ ] 游戏房间icon
## Idea
- 将reachrange也纳入卡牌的信息显示中


# [需要修复的bug（已知）](Bug)
- [1] 敌人初始会出生在岩浆格子上 🔽
- [x] 按下移动按钮后仍然能够点击结束按钮
- [x] 在tile被禁用后，寻路出现问题，没有办法及时更新路径
- [x] 在点击箭头移动摄像机后，卡牌没有跟随摄像机改变位置
- [ ] 攻击牌在第一次选择范围外的瓦片后，再选择一次范围内的敌人，能够攻击到范围内的敌人
- [ ] 卡牌位置修改，当前位置没有办法显示描述
- [ ] 在点击购买商店卡牌后，对商店内的金币数量没有进行实时更新
- [ ] 在杀死敌人后有时候普通关只有4层，第五层不会生成
- [ ] 在玩家回合结束时连续点击鼠标左键会使得敌人回合一直进行
- [x] 在鼠标射线检测时有些瓦片检测不到（原因是敌人的canvas会对射线检测产生影响，以及overlaytile和gridcell的sortingLayer不一致导致的还有他妈角色的碰撞体忘记改了） ✅ 2025-04-22




# 角色设计
**角色名称**：亚当（Adam）——公司“修理工”

**角色背景**：  
亚当是公司的一名普通维修工，擅长处理各种机械故障、建筑问题以及意外事件。公司作为一个庞然大物，由数十层高的建筑构成，每一层负责不同领域的运营。作为公司内部的维修专家，亚当对于这座建筑的每一部分都了如指掌。某一天，亚当接到了一条看似普通的“修理公司”的命令，然而踏进公司之后，一切变得完全不同，现实世界与异次元交错，公司内部被奇异的地貌和怪物占据。亚当的任务是修复这个异变的公司，找出其背后的真相。

**角色性格**：

- **坚韧且冷静**：和《死亡搁浅》的山姆相似，亚当也是一个比较沉默寡言的人，面对各种危险时显得十分坚韧。他接受了公司“修理”的命令后便毫不犹豫地承担起责任。
- **勤奋与执着**：作为一名普通员工，他从没有想过会面对这样大的危机，但他本能地想要解决问题、完成任务，即便这意味着一次又一次的死亡轮回。
- **擅长利用环境**：亚当不是武器专家，也不是什么超级英雄，他的优势是利用手边的工具和环境来克服难关。他能巧妙地运用地形来应对异次元怪物。

**外观描述**：

- **维修工装**：亚当身着略显陈旧但耐用的蓝色维修服，维修服的口袋和腰间配备了各种工具，比如扳手、撬棍、测距仪等。外面可能有一件防护用的马甲，经过多次战斗已经有了不少刮痕和泥土痕迹。
- **背包**：和山姆类似，亚当背着一个大型背包，里面装满了各类修理工具和地形构造卡片（这是他创造地形的手段）。背包设计类似工程用具，模块化方便取用。
- **工具臂**：他有一个外挂的机械工具臂（类似《死亡搁浅》中的手臂支架），可以辅助他操作复杂工具，也可以用于攻击。这只工具臂能进行延展和固定，帮助亚当攀爬楼层、搬运物体、甚至对敌人进行近距离打击。
- **面容**：亚当的面容有些疲惫感，眼神中透露出经历过许多磨难的坚毅。他留有浅胡子，头发被随意扎起以免挡住视线，眉宇间透出坚定与一丝孤独感。

**装备与能力**：

- **工具卡牌**：亚当携带特殊的卡牌，这些卡牌以土木工程知识为基础，能改变地形或创造障碍。比如可以架起桥梁，填平陷阱，甚至利用火山能量攻击敌人。这些卡牌通过他的背包和工具臂释放，形成创造与破坏的双重效果。
- **行动条与行动力**：每次行动亚当都需要合理利用行动力，包括移动、攻击和地形改造。他能通过地形与敌人的互动来改变战局，例如把敌人引入火山口或拆掉敌人脚下的砖块使其坠落。
- **遗物与升级**：每击败一个精英敌人或探索特定区域，亚当可以获取一些遗物，这些遗物可能是古老的工程手册、神秘的图纸等，可以为他的卡牌或工具臂赋予额外的能力。

**心理与情感**：

- **孤独感**：就像山姆在《死亡搁浅》中对抗荒凉与孤独，亚当在这座被异次元扭曲的公司中也感受到巨大的孤独。他常常一个人在巨大的地形中前进，身边没有人可以依靠，只有通过击败敌人和不断修理来继续前进。
- **使命感**：虽然只是普通维修工，但他深知只有自己才能“修理”这座公司，这种使命感是支撑他不断前行、从死亡中不断归来的动力。















































