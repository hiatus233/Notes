# 玩家

# 卡牌系统

## 抽卡

1. 游戏刚开始时，cardmanager首先将异步加载卡牌数据，NewGameLibrary中的卡组信息加入到现在的卡组中。
2. 游戏开始时，CardDeck将抽牌堆清空，然后遍历现在的卡组将其加入到抽牌堆中，最后执行洗牌操作。
3. 新回合开始时进行抽卡(从弃牌堆中抽取)。
## 弃牌
1. 在玩家回合结束时进行弃牌。
2. 遍历手牌，逐个加入弃牌堆，将实际的物体返回到对象池中，清空手牌并更新弃牌堆UI。
## 调整卡牌布局
1. 在抽牌和弃牌阶段过后，都需要调整卡牌布局，使得不同数量的卡牌在手牌中时都能够以合理的方式分布。
## 添加/删去卡牌
### 局内添加/删除卡牌
这种效果只需要修改**抽牌堆**和**弃牌堆**中的卡组信息即可达到对应的效果。
- 某些卡牌能够创建新的卡牌衍生物(单局对战内)
  ```ad-tip
  比如![[双持.png]]
  双持这种能够在一局对战中生成其他复制卡的卡
   ```
- 某些是单局内使用一定次数后消失的牌，比如杀戮尖塔中的**消耗**词条。

### 局外添加/删除卡牌
- 比如商店/篝火处的增删卡牌，亦或是考虑到局内达到某一条件永久获得/删去的卡牌。
这种需要更改currentCardLibrary来达到效果。
所以需要修改carddeck的逻辑让他在每次战斗结束后更新currentCardLibrary。(现在也只有单次战斗-.-)
# 商店系统
## 商品
从[卡牌](obsidian://open?vault=Obsidian%20Vault&file=game%2F%E5%8D%A1%E7%89%8C)、[遗物](obsidian://open?vault=Obsidian%20Vault&file=game%2F%E9%81%97%E7%89%A9)和药水中选取对应的商品，商品对应的csv文件摘取的是卡牌和遗物csv文件的部分字段。如下表
也就是说实际需要我们填写的不重复数据其实只有商品价格这一栏。

| 商品名称 | 商品类型 | 商品描述 | 商品价格 | 商品地址(在addressables下的地址 |
| ---- | ---- | ---- | ---- | ---------------------- |
|      |      |      |      |                        |
|      |      |      |      |                        |





# 敌人

## 敌人攻击
每个敌人的攻击会有**蓄力倒计时**，当计时器到达0时敌人会在该回合进行攻击。
## 敌人类型
敌人分为不同类型，每种类型的敌人展现的意图不同，蓄力计时器也不同
### 美术设计


| 类型  | 特点         | 蓄力回合 |
| --- | ---------- | ---- |
| 追击者 | 持续接近玩家并攻击  | 1    |
| 狙击者 | 保持距离并远距离攻击 | 3    |
| 爆发者 | 蓄力后范围攻击    | 2    |
| 阻碍者 | 制造地形以阻碍玩家  | 2    |
| 念力者 | 移动玩家位置     | 2    |

# 地形
- 地形是在地砖和瓦片上的进一步延伸，视觉效果上位于地砖和瓦片上
- 参考图： ![[陷阵之志地形参考图.png]]
- 地形意为游戏增加更多的策略维度，比如玩家可以使用移动类型的卡牌移动自身或敌人，使得对应实体移动到相应地形上产生相应效果。
- 初步设计如下：

| 地形名   | 地形效果                                               |
| ----- | -------------------------------------------------- |
| 散落的货架 | 阻挡，不可穿过，在与实体产生**碰撞**时对自身和实体造成伤害（存在耐久度，2点，每次碰撞减少一点） |
| 火焰    | 可穿过，在穿过该地砖时受到持续2回合的**灼烧**效果（灼烧：受到2点伤害）             |
| 冰霜    | 可穿过，在主动/被动穿过该地块时额外往移动方向再移动一格                       |
| 陷阱    | 可穿过，在该地块上停留时受到最大生命值50%的伤害，触发一次后消失                  |
|       |                                                    |
## 随机事件地块

### 事件
包含要跳转的对应**房间地址**字段(跳转切换到对应**房间场景**)(string)，对应的**事件ID**字段(int)，**事件名称**(string)，**事件描述**字段(string)，事件类型(枚举)。
### 随机地块
- 随机地块不同于基础的地块，是在基础地块的基础上的额外**佐料**，可以在关卡中通过达成某种条件解锁。eg.在融化x块冰块后解锁
- 某种条件包括：1.击杀一定数量的敌人 2.花费一定的金币 3.血量到达一定阈值 4.摧毁x个地块 5.制造xx地块
- 条件的检索时机在每次扳机触发结算？/回合结束/ 回合结束会影响多动流派，降低玩家爽感。 但是回合结束更符合常规逻辑，初步的设计先采用回合结束的扳机。
- 添加了随机地块的基础地块亦可以拆除，只不过拆除后会有一些增益或减益效果（大多是减益）
- 能触发的额外奖励：
- 1.升级卡牌 2.获得xx点生命值 3.获得xx遗物 4.获得药水 
- 8x8的地块最多有一块随机地块。
[[随机事件表]]

## 上下层的设计
原先采取的策略是当层敌人数量清空时玩家会上升一层，并没有提供下降到下一层的移动手段。
添加上下层间移动造成伤害的卡牌，配套遗物乃至角色的能力。
```ad-tip
从角色的设计出发，或许可以设计几个不同的角色，这些角色的移动策略可以不同，比如某些角色的能力可以直接从上层坠落至下层造成伤害。

```
问了AI之后思路拓宽了一些，或许可以这样设计
#### 具体实现

**1. 移动触发条件**



```
```// 伪代码逻辑 if (玩家处于边缘地块 || 当前地块有通道标记) {   显示上下层箭头指示器   消耗1体力 + 1行动点可执行跨层移动   if (目标位置有敌人) 触发坠落伤害计算 }`
```
**2. 地形系统扩展**

| 地形类型  | 跨层特性           | 视觉标识      |
| ----- | -------------- | --------- |
| 维修竖井  | 免费上下层(需解锁)     | 蓝色齿轮图标    |
| 断裂管道  | 单向通往特定层        | 橙色裂痕管道    |
| 临时脚手架 | 仅限向下，使用后坍塌     | 木质结构+危险标志 |
| 磁悬浮平台 | 可指定任意层，但消耗双倍体力 | 紫色发光平台    |

**3. 卡牌联动设计**

- **基础卡示例**：
    
    - ![应急梯]：在当前位置创建持续3回合的上下通道（消耗2能量）
    - ![定向爆破]：破坏当前地块直达下层，对落点造成范围伤害
- **进阶策略**：
    
    
    `配合"重力靴"遗物：允许在冰面滑行时穿透楼层边界 搭配"结构工程师"职业：可改造地形创建专属通道`
    

**4. 敌人交互规则**

- 追击者类敌人会跟随玩家跨层移动
- 狙击者会从上层进行俯射攻击（伤害+30%）
- BOSS战设计多层同步战场，需策略性切换楼层作战

**5. 平衡性保障**

- **体力限制**：基础体力上限3点，跨层移动需谨慎规划
- **坠落惩罚**：
    - 自由坠落造成(层差×3)伤害
    - 若压到敌人：对双方造成层差×5伤害
- **视觉反馈**：  
    ![[楼层过渡动效示意图.png]]  
    （采用镜头拉伸+半透明楼层叠加的过渡效果）
``
# 房间

## 休息房
休息房间初始有3点行动次数，每一次行动能选择一种增益。
提供[[#医疗]](恢复当前血量)，[[#锻造]]（升级卡牌），[[#健身]]（提高最大生命值）（每层有次数限制），[[#喝下午茶]](为下一次战斗开始提供几回合的额外能量)。
### 医疗
为玩家回复30%的最大生命值，可被遗物增加至45%
### 锻造
可以升级卡牌，提升卡牌额外基础数值/作用数量/作用范围。
### 健身
提高玩家的最大生命值（每次5点），每章存在次数上限
### 喝下午茶
为下一场战斗的前两个回合提供额外的1点能量。
## 宝箱房
宝箱房能够开启一个宝箱，其中会随机出现一个遗物和一瓶药水和一定量的金币。
也可以选择开启诅咒宝箱（内含强大的诅咒遗物），代价根据随机出的诅咒遗物进行选择。
1.下场战斗的最大能量值-1。
2.失去当前50%的血量
3.下场战斗的敌人血量增加50%。
4.每摧毁一个地块损失2点生命值
5.xx类卡牌能耗+1（持续一场战斗）
6.等等

## 商人房
在商人房可以购买商品（包括卡牌，遗物和药水），初步的UI面板如下：
![[商店初步UI面板图.png]]

## 随机事件房
随机事件房会有很多种，通过随机事件玩家会获得资源或失去资源。
### UI呈现
在UI呈现上，参考杀戮尖塔以及众多其他肉鸽游戏的事件设计。在点击房间后，弹出UI框以及一些描述的文字，给予x个选项来对应不同的应对结果（第一次触发该事件时不会标注出最终事件结果）。

### 配置表

| ID字段（唯一GUID，untiy生成） | 事件名称（Name字段） | 应对选项 | 后续结果 |     |
| -------------------- | ------------ | ---- | ---- | --- |
|                      |              |      |      |     |
|                      |              |      |      |     |
|                      |              |      |      |     |




## 关键词词条显示&意图显示系统
在各种物品的描述词条中，有**关键词条**出现时，用额外的面板对**关键词条**进行描述。E.G.：


选中并左键点击单位显示单位的移动范围，悬停在单位上显示意图，左侧显示敌人右侧显示地块信息。鼠标移动到左侧敌人头像框后会显示敌人的具体信息

![[file-20250421174658734.png]]![[file-20250421202613818.png]]