# 玩家

# 卡牌系统

## 抽卡

1. 游戏刚开始时，cardmanager首先将异步加载卡牌数据，NewGameLibrary中的卡组信息加入到现在的卡组中。
2. 游戏开始时，CardDeck将抽牌堆清空，然后遍历现在的卡组将其加入到抽牌堆中，最后执行洗牌操作。
3. 新回合开始时进行抽卡(从弃牌堆中抽取)。
## 弃牌
1. 在玩家回合结束时进行弃牌。
2. 遍历手牌，逐个加入弃牌堆，将实际的物体返回到对象池中，清空手牌并更新弃牌堆UI。
## 调整卡牌布局
1. 在抽牌和弃牌阶段过后，都需要调整卡牌布局，使得不同数量的卡牌在手牌中时都能够以合理的方式分布。
## 添加/删去卡牌
### 局内添加/删除卡牌
这种效果只需要修改**抽牌堆**和**弃牌堆**中的卡组信息即可达到对应的效果。
- 某些卡牌能够创建新的卡牌衍生物(单局对战内)
  ```ad-tip
  比如![[双持.png]]
  双持这种能够在一局对战中生成其他复制卡的卡
   ```
- 某些是单局内使用一定次数后消失的牌，比如杀戮尖塔中的**消耗**词条。

### 局外添加/删除卡牌
- 比如商店/篝火处的增删卡牌，亦或是考虑到局内达到某一条件永久获得/删去的卡牌。
这种需要更改currentCardLibrary来达到效果。
所以需要修改carddeck的逻辑让他在每次战斗结束后更新currentCardLibrary。(现在也只有单次战斗-.-)
# 商店系统
## 商品
从[卡牌](obsidian://open?vault=Obsidian%20Vault&file=game%2F%E5%8D%A1%E7%89%8C)、[遗物](obsidian://open?vault=Obsidian%20Vault&file=game%2F%E9%81%97%E7%89%A9)和药水中选取对应的商品，商品对应的csv文件摘取的是卡牌和遗物csv文件的部分字段。如下表
也就是说实际需要我们填写的不重复数据其实只有商品价格这一栏。

| 商品名称 | 商品类型 | 商品描述 | 商品价格 | 商品地址(在addressables下的地址 |
| ---- | ---- | ---- | ---- | ---------------------- |
|      |      |      |      |                        |
|      |      |      |      |                        |

# 随机事件系统

## 事件
包含要跳转的对应**房间地址**字段(跳转切换到对应**房间场景**)(string)，对应的**事件ID**字段(int)，**事件名称**(string)，**事件描述**字段(string)，事件类型(枚举)。

## 随机地块
- 随机地块不同于基础的地块，是在基础地块的基础上的额外**佐料**，可以在关卡中通过达成某种条件解锁。eg.在融化x块冰块后解锁
- 添加了随机地块的基础地块亦可以拆除，只不过拆除后会有一些增益或减益效果（大多是减益）
- 8x8的地块最多有一块随机地块。
[[随机事件表]]
# 敌人

## 敌人攻击
每个敌人的攻击会有**蓄力倒计时**，当计时器到达0时敌人会在该回合进行攻击。
## 敌人类型
敌人分为不同类型，每种类型的敌人展现的意图不同，蓄力计时器也不同

| 类型  | 特点         | 蓄力回合 |
| --- | ---------- | ---- |
| 追击者 | 持续接近玩家并攻击  | 1    |
| 狙击者 | 保持距离并远距离攻击 | 3    |
| 爆发者 | 蓄力后范围攻击    | 2    |
| 阻碍者 | 制造地形以阻碍玩家  | 2    |
| 念力者 | 移动玩家位置     | 2    |

# 地形
- 地形是在地砖和瓦片上的进一步延伸，视觉效果上位于地砖和瓦片上
- 参考图： ![[陷阵之志地形参考图.png]]
- 地形意为游戏增加更多的策略维度，比如玩家可以使用移动类型的卡牌移动自身或敌人，使得对应实体移动到相应地形上产生相应效果。
- 初步设计如下：

| 地形名   | 地形效果                                               |
| ----- | -------------------------------------------------- |
| 散落的货架 | 阻挡，不可穿过，在与实体产生**碰撞**时对自身和实体造成伤害（存在耐久度，2点，每次碰撞减少一点） |
| 火焰    | 可穿过，在穿过该地砖时受到持续2回合的**灼烧**效果（灼烧：受到2点伤害）             |
| 冰霜    | 可穿过，在主动/被动穿过该地块时额外往移动方向再移动一格                       |
| 陷阱    | 可穿过，在该地块上停留时受到最大生命值50%的伤害，触发一次后消失                  |
|       |                                                    |

- 
  
# 房间

## 休息房
休息房间初始有3点行动次数，每一次行动能选择一种增益。
提供[[#医疗]](恢复当前血量)，[[#锻造]]（升级卡牌），[[#健身]]（提高最大生命值）（每层有次数限制），[[#喝下午茶]](为下一次战斗开始提供几回合的额外能量)。
### 医疗
为玩家回复30%的最大生命值，可被遗物增加至45%
### 锻造
可以升级卡牌，提升卡牌额外基础数值/作用数量/作用范围。
### 健身
提高玩家的最大生命值，每章存在次数上限
### 喝下午茶
为下一场战斗的前两个回合提供额外的1点能量。
## 宝箱房
宝箱房能够开启一个宝箱，其中会随机出现一个遗物和一瓶药水和一定量的金币。

## 商人房
在商人房可以购买商品（包括卡牌，遗物和药水），初步的UI面板如下：
![[商店初步UI面板图.png]]

## 随机事件房
随机事件房会有很多种，通过随机事件玩家会获得资源或失去资源。

| 事件名称 | 事件效果 |
| ---- | ---- |
|      |      |
|      |      |
|      |      |

